<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestor de Pedidos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-white min-h-screen flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold text-red-600 mb-6">Gestor de Pedidos</h1>

  <!-- Pedidos terminados -->
  <section class="w-full max-w-3xl mb-8">
    <h2 class="text-xl font-semibold text-green-700 mb-2">Pedidos Terminados</h2>
    <div id="pedidos-terminados" class="bg-green-50 p-4 rounded-xl shadow"></div>
  </section>

  <!-- Botón para nuevo pedido -->
  <button id="nuevoPedidoBtn" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-2 rounded-lg mb-6 transition">
    Nuevo Pedido
  </button>

  <!-- Formulario de pedido -->
  <section id="formulario" class="hidden w-full max-w-3xl bg-green-50 p-6 rounded-xl shadow">
    <h2 class="text-xl font-semibold mb-4 text-green-700">Nuevo Pedido</h2>

    <label class="block mb-2 text-sm font-medium">Nombre del Cliente</label>
    <input id="nombre" type="text" class="w-full border p-2 rounded mb-4" placeholder="Ej: Juan Pérez" />

    <label class="block mb-2 text-sm font-medium">Dirección</label>
    <input id="direccion" type="text" class="w-full border p-2 rounded mb-4" placeholder="Ej: Calle 123" />

    <h3 class="text-lg font-semibold text-green-700 mb-2">Productos</h3>
    <table class="w-full mb-4">
      <thead>
        <tr class="text-left text-sm font-medium">
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Precio</th>
        </tr>
      </thead>
      <tbody id="tablaProductos"></tbody>
    </table>
    <button id="agregarProducto" class="bg-green-600 hover:bg-green-700 text-white px-4 py-1 rounded mb-4 transition">
      + Agregar producto
    </button>

    <div class="flex justify-end gap-2">
      <button id="cancelar" class="bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded transition">Cancelar</button>
      <button id="guardar" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition">Guardar Pedido</button>
    </div>
  </section>

  <!-- Lista de pedidos pendientes -->
  <section class="w-full max-w-3xl mt-8">
    <h2 class="text-xl font-semibold text-red-700 mb-2">Pedidos Pendientes</h2>
    <div id="pedidosPendientes" class="bg-red-50 p-4 rounded-xl shadow"></div>
  </section>

  <script>
  const { jsPDF } = window.jspdf;

  const nuevoPedidoBtn = document.getElementById('nuevoPedidoBtn');
  const formulario = document.getElementById('formulario');
  const cancelarBtn = document.getElementById('cancelar');
  const guardarBtn = document.getElementById('guardar');
  const agregarProductoBtn = document.getElementById('agregarProducto');
  const tablaProductos = document.getElementById('tablaProductos');
  const pedidosPendientes = document.getElementById('pedidosPendientes');
  const pedidosTerminados = document.getElementById('pedidos-terminados');

  let pedidos = JSON.parse(localStorage.getItem('pedidos')) || [];
  let numeroRemito = parseInt(localStorage.getItem('numeroRemito') || "1");

  const renderPedidos = () => {
    pedidosPendientes.innerHTML = '';
    pedidosTerminados.innerHTML = '';
    pedidos.forEach((pedido, index) => {
      const pedidoHTML = document.createElement('div');
      pedidoHTML.className =
        'bg-white p-4 rounded-lg shadow mb-3 border-l-4 ' +
        (pedido.terminado ? 'border-green-500' : 'border-red-500');

      const total = pedido.productos.reduce(
        (sum, p) => sum + (parseFloat(p.precio) * parseFloat(p.cantidad) || 0),
        0
      );

      pedidoHTML.innerHTML = `
        <p><strong>Cliente:</strong> ${pedido.nombre}</p>
        <p><strong>Dirección:</strong> ${pedido.direccion}</p>
        <p><strong>Fecha:</strong> ${pedido.fecha}</p>
        <p><strong>Productos:</strong></p>
        <ul class="list-disc ml-6">
          ${pedido.productos
            .map((p) => `<li>${p.nombre} (${p.cantidad}) - $${p.precio}</li>`)
            .join('')}
        </ul>
        <p class="mt-2 font-semibold">Total: $${total.toFixed(2)}</p>
        <div class="flex gap-2 mt-3">
          ${
            !pedido.terminado
              ? `<button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded" onclick="terminarPedido(${index})">Terminar</button>`
              : ''
          }
          <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded" onclick="descargarPDF(${index})">Descargar PDF</button>
          <button class="bg-gray-400 hover:bg-gray-500 text-white px-3 py-1 rounded" onclick="eliminarPedido(${index})">Eliminar</button>
        </div>
      `;

      if (pedido.terminado) pedidosTerminados.appendChild(pedidoHTML);
      else pedidosPendientes.appendChild(pedidoHTML);
    });
  };

  nuevoPedidoBtn.addEventListener('click', () => {
    formulario.classList.remove('hidden');
    nuevoPedidoBtn.classList.add('hidden');
    tablaProductos.innerHTML = '';
    document.getElementById('nombre').value = '';
    document.getElementById('direccion').value = '';
  });

  cancelarBtn.addEventListener('click', () => {
    formulario.classList.add('hidden');
    nuevoPedidoBtn.classList.remove('hidden');
  });

  agregarProductoBtn.addEventListener('click', () => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td><input type="text" class="border p-1 rounded w-full" placeholder="Producto"></td>
      <td><input type="number" class="border p-1 rounded w-full" placeholder="Cantidad"></td>
      <td><input type="number" class="border p-1 rounded w-full" placeholder="Precio"></td>
    `;
    tablaProductos.appendChild(row);
  });

  guardarBtn.addEventListener('click', () => {
    const nombre = document.getElementById('nombre').value.trim();
    const direccion = document.getElementById('direccion').value.trim();
    const fecha = new Date().toLocaleDateString();
    const productos = Array.from(tablaProductos.querySelectorAll('tr')).map((row) => ({
      nombre: row.children[0].querySelector('input').value,
      cantidad: row.children[1].querySelector('input').value,
      precio: row.children[2].querySelector('input').value,
    }));

    if (!nombre || !direccion || productos.length === 0) {
      alert('Por favor completa todos los campos y agrega al menos un producto.');
      return;
    }

    pedidos.push({ nombre, direccion, fecha, productos, terminado: false, numero: numeroRemito });
    numeroRemito++;
    localStorage.setItem('numeroRemito', numeroRemito);
    localStorage.setItem('pedidos', JSON.stringify(pedidos));
    renderPedidos();
    formulario.classList.add('hidden');
    nuevoPedidoBtn.classList.remove('hidden');
  });

  window.terminarPedido = (index) => {
    pedidos[index].terminado = true;
    localStorage.setItem('pedidos', JSON.stringify(pedidos));
    renderPedidos();
  };

  window.eliminarPedido = (index) => {
    if (confirm('¿Seguro que querés eliminar este pedido?')) {
      pedidos.splice(index, 1);
      localStorage.setItem('pedidos', JSON.stringify(pedidos));
      renderPedidos();
    }
  };

  // --- NUEVO FORMATO COLORIDO ---
  window.descargarPDF = (index) => {
    const pedido = pedidos[index];
    const doc = new jsPDF({ orientation: "portrait", unit: "px", format: "a4" });

    // Encabezado rojo
    doc.setFillColor(200, 0, 0);
    doc.rect(0, 0, 420, 80, "F");

    // Logo / Nombre empresa en blanco
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(18);
    doc.text("GM-DISTRIBUCIONES", 30, 35);
    doc.setFontSize(12);
    doc.text("Flavio Giulioni", 30, 50);

    // Datos empresa
    doc.setFontSize(10);
    doc.text("gmdistribuciones3@gmail.com", 30, 65);
    doc.text("CUIT: 20-25804000-8  |  +54 3425014152", 30, 78);

    // Remito info arriba derecha
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(12);
    doc.text(`Remito N° ${pedido.numero}`, 300, 35);
    doc.text(`Fecha: ${pedido.fecha}`, 300, 50);

    // Sección cliente
    doc.setDrawColor(0, 150, 0);
    doc.setLineWidth(1);
    doc.line(30, 100, 390, 100);
    doc.setTextColor(0, 100, 0);
    doc.setFontSize(13);
    doc.text("DATOS DEL CLIENTE", 30, 95);
    doc.setTextColor(0, 0, 0);
    doc.setFontSize(12);
    doc.text(`Nombre: ${pedido.nombre}`, 30, 120);
    doc.text(`Dirección: ${pedido.direccion}`, 30, 135);

    // Sección productos
    doc.setTextColor(0, 100, 0);
    doc.setFontSize(13);
    doc.text("PRODUCTOS", 30, 160);
    doc.setDrawColor(0, 150, 0);
    doc.line(30, 165, 390, 165);
    doc.setFontSize(12);
    doc.setTextColor(0, 0, 0);

    let y = 185;
    doc.text("Producto", 30, y);
    doc.text("Cant.", 200, y);
    doc.text("Precio", 270, y);
    doc.text("Subtotal", 340, y);
    y += 10;
    doc.line(30, y, 390, y);
    y += 15;

    let total = 0;
    pedido.productos.forEach((p) => {
      const subtotal = (parseFloat(p.precio) * parseFloat(p.cantidad)) || 0;
      total += subtotal;
      doc.text(p.nombre, 30, y);
      doc.text(String(p.cantidad), 205, y);
      doc.text(`$${p.precio}`, 270, y);
      doc.text(`$${subtotal.toFixed(2)}`, 340, y);
      y += 20;
    });

    // Total
    doc.setDrawColor(0, 150, 0);
    doc.line(30, y, 390, y);
    y += 25;
    doc.setFontSize(14);
    doc.setTextColor(200, 0, 0);
    doc.text(`TOTAL: $${total.toFixed(2)}`, 270, y);

    // Información de pago
    y += 50;
    doc.setTextColor(0, 100, 0);
    doc.setFontSize(13);
    doc.text("INFORMACIÓN DE PAGO", 30, y);
    doc.setDrawColor(0, 150, 0);
    doc.line(30, y + 5, 390, y + 5);
    y += 20;
    doc.setFontSize(11);
    doc.setTextColor(0, 0, 0);
    doc.text("Alias: ____________________________", 30, y);
    y += 15;
    doc.text("Banco: ____________________________", 30, y);
    y += 15;
    doc.text("Datos de la cuenta: Flavio Giulioni", 30, y);
    y += 15;
    doc.text("CUIT: 20-25804000-8", 30, y);

    // Pie de página
    doc.setTextColor(150);
    doc.setFontSize(10);
    doc.text("Gracias por su compra - GM Distribuciones", 30, 575);

    // Descargar
    doc.save(`Remito_${pedido.nombre}.pdf`);
  };

  renderPedidos();
</script>



</body>
</html>
